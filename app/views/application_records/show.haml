%h1 Application Record

submitted by
= @record.user.full_name
= format_date_time @record.created_at

.questions_responses_container
  .questions_column
    %strong
      %h3 Question
    - @record.responses.keys.each do |prompt|
      .question_item
      %strong= prompt
  .responses_column
    %strong
      %h3 Response
    - @record.responses.values.each do |response|
      .response_item
      = response

- if @current_user.staff?
  - if @record.pending?
    %h3 Review application
    = form_tag controller: :application_records,
      action: :review,
      id: @record.id,
      accepted: false do
      .app_review_container
        .app_review_item
          .field
            Reason for rejection:
            = text_area_tag :staff_note, '', required: true
        .app_review_item
        .text
          - if configured_value [:on_application_denial, :provide_reason],
                                default: true
            These notes will be provided to the applicant.
          - else
            These notes will not be provided to the applicant.
        .app_review_item
        .action= submit_tag 'Review application without scheduling interview'
    = form_tag controller: :application_records,
      action: :review,
      id: @record.id,
      accepted: true do
      .app_review_container
        = fields_for :interview do |f|
          .app_review_item
            .field
              = f.label :scheduled, 'Date and time of interview'
              = f.text_field :scheduled,
                class: 'datetimepicker',
                placeholder: 'Click here to select date/time...',
                size: 40, required: true
          .app_review_item
            .field
              = f.label :location
              = f.text_field :location, required: true
        .app_review_container
          .app_review_item
            .action= submit_tag 'Review application and schedule interview'
  - else
    .app_review_container
      Application reviewed on
      = format_date_time @record.updated_at
      - if @record.staff_note.present?
        .app_review_item
        .notes
          Reason for denial:
          = @record.staff_note
      - if @interview.present?
        .app_review_item
        - if @interview.pending?
          Interview is scheduled for:
          = @interview.information
          .app_review_item
          .export_link= link_to 'Click here for a calendar export file',
            interview_path(@interview, format: :ics)
          %h3 Reschedule interview
          = form_tag controller: :interviews,
            action: :reschedule,
            id: @interview.id do
            New interview date/time:
            = text_field_tag :scheduled, '',
              required: true, class: 'datetimepicker',
              placeholder: 'Click here to select date/time...', size: 30
            .app_review_item
            New location:
            = text_field_tag :location, @interview.location,
              required: true, size: 30
            .app_review_item
            = submit_tag 'Reschedule interview'
          = form_tag controller: :interviews,
            action: :complete,
            id: @interview.id do
            .app_review_item
            = submit_tag 'Mark interview as completed'
        - else # application is being reviewed for whatever reason
          Interview occurred on
          = @interview.information
- else # student
  - if @record.pending?
    Your application is pending and has not yet been reviewed.
    - if configured_value [:on_application_denial, :notify_applicant],
      default: true
      You will be notified when your application has been reviewed.
    - else
      You will be contacted if an interview is requested.
  - else
    - if @interview.present?
      - if @interview.pending?
        Your interview is scheduled for
      - else
        Your interview occurred on
      = @interview.information
    - else
      Your application has been denied.
      - if configured_value([:on_application_denial, :provide_reason],
        default: true)
        Reason:
        = @record.staff_note
